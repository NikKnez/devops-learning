# Labs 31-40


## Lab 31: Rebasing VS Merging

## Goals

    Learn the differences between rebasing and merging.

## Discussion

Let’s explore the differences between merging and rebasing. In order to do so, we need to rewind the repository back in time before the first merge, and then redo the same steps, but using rebasing rather than merging.

We will make use the of the reset command to wind the branches back in time.



## Lab 32:  Resetting the Greet Branch

## Goals

    Reset the greet branch to the point before the first merge.

## Reset the greet branch

Let’s go back in time on the greet branch to the point before we merged main onto it. We can reset a branch to any commit we want. Essentially this is modifying the branch pointer to point to anywhere in the commit tree.

In this case we want to back greet up to the point prior to the merge with main. We need to find the last commit before the merge.
Execute:

git checkout greet

git hist

Output:

$ git checkout greet
Already on 'greet'
$ git hist
*   73db54b 2023-06-10 | Merged main fixed conflict. (HEAD -> greet) [Jim Weirich]
|\  
| * 3787562 2023-06-10 | Made interactive (main) [Jim Weirich]
* | 82a2988 2023-06-10 | Merge branch 'main' into greet [Jim Weirich]
|\| 
| * 976950b 2023-06-10 | Added README [Jim Weirich]
* | c1a7120 2023-06-10 | Updated Rakefile [Jim Weirich]
* | 959a7cb 2023-06-10 | Hello uses Greeter [Jim Weirich]
* | cab1837 2023-06-10 | Added greeter class [Jim Weirich]
|/  
* cdceefa 2023-06-10 | Added a Rakefile. [Jim Weirich]
* 22273f2 2023-06-10 | Moved hello.rb to lib [Jim Weirich]
* 186488e 2023-06-10 | Add an author/email comment [Jim Weirich]
* e4e3645 2023-06-10 | Added a comment (tag: v1) [Jim Weirich]
* a6b268e 2023-06-10 | Added a default value (tag: v1-beta) [Jim Weirich]
* 174dfab 2023-06-10 | Using ARGV [Jim Weirich]
* f7c41d3 2023-06-10 | First Commit [Jim Weirich]

That’s a bit hard to read, but looking at the data we see that the “Updated Rakefile” commit was the last commit on the greet branch before merging. Let’s reset the greet branch to that commit.
Execute:

git reset --hard <hash>

Output:

$ git reset --hard c1a7120
HEAD is now at c1a7120 Updated Rakefile

## Check the branch.

Look at the log for the greet branch. We no longer have the merge commits in its history.
Execute:

git hist --all

Output:

$ git hist --all
* 3787562 2023-06-10 | Made interactive (main) [Jim Weirich]
* 976950b 2023-06-10 | Added README [Jim Weirich]
| * c1a7120 2023-06-10 | Updated Rakefile (HEAD -> greet) [Jim Weirich]
| * 959a7cb 2023-06-10 | Hello uses Greeter [Jim Weirich]
| * cab1837 2023-06-10 | Added greeter class [Jim Weirich]
|/  
* cdceefa 2023-06-10 | Added a Rakefile. [Jim Weirich]
* 22273f2 2023-06-10 | Moved hello.rb to lib [Jim Weirich]
* 186488e 2023-06-10 | Add an author/email comment [Jim Weirich]
* e4e3645 2023-06-10 | Added a comment (tag: v1) [Jim Weirich]
* a6b268e 2023-06-10 | Added a default value (tag: v1-beta) [Jim Weirich]
* 174dfab 2023-06-10 | Using ARGV [Jim Weirich]
* f7c41d3 2023-06-10 | First Commit [Jim Weirich]


## Lab 33: Resetting the Main Branch

## Goals

    Reset the main branch to the point before the conflicting commit.

## Reset the main branch

When we added the interactive mode to the main branch, we made a change that conflicted with changes in the greet branch. Let’s rewind the main branch to a point before the conflicting change. This allows us to demonstrate the rebase command without worrying about conflicts.
Execute:

git checkout main

git hist

Output:

$ git hist
* 3787562 2023-06-10 | Made interactive (HEAD -> main) [Jim Weirich]
* 976950b 2023-06-10 | Added README [Jim Weirich]
* cdceefa 2023-06-10 | Added a Rakefile. [Jim Weirich]
* 22273f2 2023-06-10 | Moved hello.rb to lib [Jim Weirich]
* 186488e 2023-06-10 | Add an author/email comment [Jim Weirich]
* e4e3645 2023-06-10 | Added a comment (tag: v1) [Jim Weirich]
* a6b268e 2023-06-10 | Added a default value (tag: v1-beta) [Jim Weirich]
* 174dfab 2023-06-10 | Using ARGV [Jim Weirich]
* f7c41d3 2023-06-10 | First Commit [Jim Weirich]

The ‘Added README’ commit is the one directly before the conflicting interactive mode. We will reset the main branch to ‘Added README’ commit.
Execute:

git reset --hard <hash>

git hist --all

Review the log. It should look like the repository has been wound back in time to the point before we merged anything.
Output:

$ git hist --all
* 976950b 2023-06-10 | Added README (HEAD -> main) [Jim Weirich]
| * c1a7120 2023-06-10 | Updated Rakefile (greet) [Jim Weirich]
| * 959a7cb 2023-06-10 | Hello uses Greeter [Jim Weirich]
| * cab1837 2023-06-10 | Added greeter class [Jim Weirich]
|/  
* cdceefa 2023-06-10 | Added a Rakefile. [Jim Weirich]
* 22273f2 2023-06-10 | Moved hello.rb to lib [Jim Weirich]
* 186488e 2023-06-10 | Add an author/email comment [Jim Weirich]
* e4e3645 2023-06-10 | Added a comment (tag: v1) [Jim Weirich]
* a6b268e 2023-06-10 | Added a default value (tag: v1-beta) [Jim Weirich]
* 174dfab 2023-06-10 | Using ARGV [Jim Weirich]
* f7c41d3 2023-06-10 | First Commit [Jim Weirich]


## Lab 34: Rebasing

## Goals

    Use the rebase command rather than the merge command.

Ok, we are back in time before the first merge and we want to get the changes in main into our greet branch.

This time we will use the rebase command instead of the merge command to bring in the changes from the main branch.
Execute:

git checkout greet

git rebase main

git hist

Output:

$ go greet
Switched to branch 'greet'
$
$ git rebase main
First, rewinding head to replay your work on top of it...
Applying: added Greeter class
Applying: hello uses Greeter
Applying: updated Rakefile
$
$ git hist
* 5f626c6 2023-06-10 | Updated Rakefile (HEAD -> greet) [Jim Weirich]
* 24d82d4 2023-06-10 | Hello uses Greeter [Jim Weirich]
* 619f552 2023-06-10 | Added greeter class [Jim Weirich]
* 976950b 2023-06-10 | Added README (main) [Jim Weirich]
* cdceefa 2023-06-10 | Added a Rakefile. [Jim Weirich]
* 22273f2 2023-06-10 | Moved hello.rb to lib [Jim Weirich]
* 186488e 2023-06-10 | Add an author/email comment [Jim Weirich]
* e4e3645 2023-06-10 | Added a comment (tag: v1) [Jim Weirich]
* a6b268e 2023-06-10 | Added a default value (tag: v1-beta) [Jim Weirich]
* 174dfab 2023-06-10 | Using ARGV [Jim Weirich]
* f7c41d3 2023-06-10 | First Commit [Jim Weirich]

## Merge VS Rebase

The final result of the rebase is very similar to the merge. The greet branch now contains all of its changes, as well as all the changes from the main branch. However, the commit tree is quite different. The commit tree for the greet branch has been rewritten so that the main branch is a part of the commit history. This leaves the chain of commits linear and much easier to read.

## When to Rebase, When to Merge?

Don’t use rebase …

    If the branch is public and shared with others. Rewriting publicly shared branches will tend to screw up other members of the team.
    When the exact history of the commit branch is important (since rebase rewrites the commit history).

Given the above guidelines, I tend to use rebase for short-lived, local branches and merge for branches in the public repository.


## Lab 35: Merging Back to Main

## Goals

    We’ve kept our greet branch up to date with main (via rebase), now let’s merge the greet changes back into the main branch.

## Merge greet into main
Execute:

git checkout main

git merge greet

Output:

$ git checkout main
Switched to branch 'main'
$
$ git merge greet
Updating 976950b..5f626c6
Fast-forward
 Rakefile       | 2 +-
 lib/greeter.rb | 8 ++++++++
 lib/hello.rb   | 6 ++++--
 3 files changed, 13 insertions(+), 3 deletions(-)
 create mode 100644 lib/greeter.rb

Because the head of main is a direct ancestor of the head of the greet branch, git is able to do a fast-forward merge. When fast-forwarding, the branch pointer is simply moved forward to point to the same commit as the greeter branch.

There will never be conflicts in a fast-forward merge.

## Review the logs
Execute:

git hist

Output:

$ git hist
* 5f626c6 2023-06-10 | Updated Rakefile (HEAD -> main, greet) [Jim Weirich]
* 24d82d4 2023-06-10 | Hello uses Greeter [Jim Weirich]
* 619f552 2023-06-10 | Added greeter class [Jim Weirich]
* 976950b 2023-06-10 | Added README [Jim Weirich]
* cdceefa 2023-06-10 | Added a Rakefile. [Jim Weirich]
* 22273f2 2023-06-10 | Moved hello.rb to lib [Jim Weirich]
* 186488e 2023-06-10 | Add an author/email comment [Jim Weirich]
* e4e3645 2023-06-10 | Added a comment (tag: v1) [Jim Weirich]
* a6b268e 2023-06-10 | Added a default value (tag: v1-beta) [Jim Weirich]
* 174dfab 2023-06-10 | Using ARGV [Jim Weirich]
* f7c41d3 2023-06-10 | First Commit [Jim Weirich]

The greet and main branches are now identical.


## Lab 36: Multiple Repositories

Up to this point we have been working with a single git repository. However, git excels at working with multiple repositories. These extra repositories may be stored locally, or may be accessed across a network connection.

In the next section we will create a new repository called “cloned_hello”. We will show how to move changes from one repository to another, and how to handle conflicts when they arise between two repositories.

For now, we will be working with local repositories (i.e. repositories stored on your local hard disk), however most of the things learned in this section will apply to multiple repositories whether they are stored locally or remotely over a network.

NOTE: We are going be making changes to both copies of our repositories. Make sure you pay attention to which repository you are in at each step of the following labs.


## Lab 37: Cloning Repositories

## Goals

    Learn how to make copies of repositories.

## Go to the work directory

Go to the working directory and make a clone of your hello repository.
Execute:

cd ..

pwd

ls

NOTE: Now in the work directory.
Output:

$ cd ..
$ pwd
/Users/jim/Downloads/git_tutorial/work
$ ls
hello

At this point you should be in your “work” directory. There should be a single repository here named “hello”.

## Create a clone of the hello repository

Let’s make a clone of the repository.
Execute:

git clone hello cloned_hello

ls

Output:

$ git clone hello cloned_hello
Cloning into 'cloned_hello'...
done.
$ ls
cloned_hello
hello

There should now be two repositories in your work directory: the original “hello” repository and the newly cloned “cloned_hello” repository.


## Lab 38: Review the Cloned Repository

## Goals

    Learn about branches on remote repositories.

## Look at the cloned repository

Let’s take a look at the cloned repository.
Execute:

cd cloned_hello

ls

Output:

$ cd cloned_hello
$ ls
README
Rakefile
lib

You should see a list of all the files in the top level of the original repository (README, Rakefile and lib).

## Review the Repository History
Execute:

git hist --all

Output:

$ git hist --all
* 5f626c6 2023-06-10 | Updated Rakefile (HEAD -> main, origin/main, origin/greet, origin/HEAD) [Jim Weirich]
* 24d82d4 2023-06-10 | Hello uses Greeter [Jim Weirich]
* 619f552 2023-06-10 | Added greeter class [Jim Weirich]
* 976950b 2023-06-10 | Added README [Jim Weirich]
* cdceefa 2023-06-10 | Added a Rakefile. [Jim Weirich]
* 22273f2 2023-06-10 | Moved hello.rb to lib [Jim Weirich]
* 186488e 2023-06-10 | Add an author/email comment [Jim Weirich]
* e4e3645 2023-06-10 | Added a comment (tag: v1) [Jim Weirich]
* a6b268e 2023-06-10 | Added a default value (tag: v1-beta) [Jim Weirich]
* 174dfab 2023-06-10 | Using ARGV [Jim Weirich]
* f7c41d3 2023-06-10 | First Commit [Jim Weirich]

You should now see a list of all the commits in the new repository, and it should (more or less) match the history of commits in the original repository. The only difference should be in the names of the branches.

## Remote branches

You should see a main branch (along with HEAD) in the history list. But you will also have a number of strangely named branches (origin/main, origin/greet and origin/HEAD). We’ll talk about them in a bit.


## Lab 39: What is Origin?

## Goals

    Learn about naming remote repositories.

Execute:

git remote

Output:

$ git remote
origin

We see that the cloned repository knows about a remote repository named origin. Let’s see if we can get more information about origin:
Execute:

git remote show origin

Output:

$ git remote show origin
warning: more than one branch.main.remote
* remote origin
  Fetch URL: /Users/jim/Downloads/git_tutorial/work/hello
  Push  URL: /Users/jim/Downloads/git_tutorial/work/hello
  HEAD branch: main
  Remote branches:
    greet tracked
    main  tracked
  Local branches configured for 'git pull':
    main   merges with remote main
              and with remote main
    master merges with remote master
  Local ref configured for 'git push':
    main pushes to main (up to date)

Now we see that the remote repository “origin” is simply the original hello repository. Remote repositories typically live on a separate machine, possibly a centralized server. As we can see here, however, they can just as well point to a repository on the same machine. There is nothing particularly special about the name “origin”, however the convention is to use the name “origin” for the primary centralized repository (if there is one).


## Lab 40: Remote Branches

## Goals

    Learn about local VS remote branches

Let’s look at the branches available in our cloned repository.
Execute:

git branch

Output:

$ git branch
* main

That’s it, only the main branch is listed. Where is the greet branch? The git branch command only lists the local branches by default.

## List Remote Branches

Try this to see all the branches:
Execute:

git branch -a

Output:

$ git branch -a
* main
  remotes/origin/HEAD -> origin/main
  remotes/origin/greet
  remotes/origin/main

Git has all the commits from the original repository, but branches in the remote repository are not treated as local branches here. If we want our own greet branch, we need to create it ourselves. We will see how to do that in a minute.
